# 의존성 역전 원칙

## 정의

의존성 역전 원칙(Dependency Inversion Principle)은 소프트웨어 모듈들 사이의 의존성을 줄이기 위해 사용되는 객체지향 설계 원칙 중 하나이다.
이 원칙은 고수준 모듈이 저수준 모듈에 의존하면 안되며, 두 모듈 모두 추상화에 의존해야 한다는 것을 말한다. 
또한, 추상화는 세부사항에 의존하면 안되며, 세부사항이 추상화에 의존해야 한다.
라고 Copilot이 알려줬는데 알아봅시다.

1. 상위 수준의 모듈은 하위 수준의 모듈에 의존해서는 안된다. 둘 모두 추상화에 의존해야 한다.
2. 추상화는 구체적인 사항에 의존해서는 안 된다. 구체적인 사항은 추상화에 의존해야 한다. 

---
### 이뭔씹?
정의만으로는 이해하기 어렵지만, 개념은 이해하고 있어야 한다.
하위 수준의 모듈이 상위 수준의 모듈에 의존을 해야한다는 것이다.
모듈은 좀 작은 단위로 소프트웨어 시스템을 쪼개놓은 것인데, 서로 좀 더 긴밀하게 연관관계가 있는, 그리고 같은 수준의 모듈끼리는 의존을 해도 된다는 것이다.

그리고 JVM 언어 수준에서 패키지가 일종의 모듈을 구분하는 기준이 될 수도 있다.
패키지로 구분한 것이 나중에 jar 파일로 이루어진 모듈 단위 분리에 대한 가능성을 지니고 있다고 생각한다. 

아까 개발한 PaymentService같은 경우 우리가 제공하는 비즈니스의 가장 중요한 핵심 로직을 담고 있는 정책 모듈이다.
또 하나는 WebApiExRateProvider 같은 경우 다양하게 외부 또는 내부에서 환율 정보를 어떻게 가져올 것인지에 대한 관심사를 다루는 메카니즘 모듈이라 볼 수 있다.

이렇게 실제로 런타임 환경에서 어떻게 사용되는 가 하면, PaymentService가 WebApiExRateProvider를 의존하고 있다.
과연 좋은 결과인가?

---
### 본론
결론부터 말하자면, 이것은 좋은 설계가 아니다.
WebApiExRateProvider가 변경되면 PaymentService도 변경되어야 한다.
이런 구조를 개선하기 위해 의존성 역전 원칙을 적용하는 것인데, 이것은 결국 인터페이스를 활용한 추상화에 의존하는 것이다.

모듈을 구분할 때, 패키지로 구분한다고 했었다.
그리고 추상화에만 모든 코드들이 추상화에 의존하도록 만들어놨으니 의존성 역전 원칙에 의거하는가?

지금 현재 PaymentService는 WebApiExRateProvider에 의존하고 있다.
벌써부터 의존성 역전 원칙에 위배되고 있다.
WebApiExRateProvider가 바뀌면 PaymentService도 바뀌게 된다. (스프링에 적합한 코드는 작성되었다만)

여기서 이제 필요한 것은??

### 인터페이스 소유권의 역전이 필요하다.
인터페이스 소유권의 역전이란, 인터페이스를 소유하는 쪽이 의존성을 가지는 쪽이 되도록 하는 것이다.
여기서 사용되는 Architecture Pattern으로 Separated Interface Pattern이 있다.

인터페이스는 어느 패키지에 존재하는가?
인터페이스를 사용하는 패키지에 존재해야 한다.
지금 ExRateProvider 인터페이스는 PaymentService 패키지에 존재하고 있다.
인터페이스에 대한 소유권이 지금 역전되고 있는 상황이다.

모듈 간의 의존 관계가 하위에서 상위로 바뀐 것이며, 인터페이스를 만들어서 상위 모듈로 옮기고 상위 모듈이 인터페이스를 소유하도록 만들어야 한다.
이것이 의존성 역전 원칙을 적용한 것이다.